global:
  domain: argocd.dataplumbers.ch
server:
  # Disable SSL to allow to configure TLS connection on the ingress
  insecure: true
  service:
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-prod
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  ingress:
      enabled: true
      controller: generic
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
        nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      ingressClassName: "nginx"
      hostname: "argocd.dataplumbers.ch"
      tls: 
        - hosts:
            - "argocd.dataplumbers.ch"
          secretName: argocd-tls
      path: /
      pathType: Prefix
      backend:
        service:
          name: argocd-server
          port:
            number: 80 
  
configs:
  rbac:
    policy.csv: |
      g, jan.matter@dataplumbers.ch, role:admin
    policy.default: role:readonly

dex:
  config:
    connectors:
      - type: oidc
        id: infomaniak
        name: Infomaniak
        config:
          issuer: https://login.infomaniak.com/
          clientIDEnv: INFOMANIAK_ARGOCD_CLIENT_ID
          clientSecretEnv: INFOMANIAK_ARGOCD_SECRET
          redirectURI: https://argocd.dataplumbers.ch/api/dex/callback/
          hostedDomains:
            - dataplumbers.ch

env:
  - name: INFOMANIAK_ARGOCD_CLIENT_ID
    valueFrom:
      secretKeyRef:
        name: infomaniak-argocd-oauth-credentials
        key: clientID
  - name: INFOMANIAK_ARGOCD_SECRET
    valueFrom:
      secretKeyRef:
        name: infomaniak-argocd-oauth-credentials
        key: secret
          

